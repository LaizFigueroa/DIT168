# DIT168 - Group 13

This repository provides the source code for the DIT 168 Project from group 13.

## Table of Contents
* [Introduction](#introduction)
* [License](#license)
* [Organization](#organization)
* [Getting Started](#getting-started)
* [Cloning](#cloning)
* [Building](#building)
* [Running Tests](#running-tests)
* [Docker Images](#docker-images)
* [Docker Compose](#docker-compose)
* [References](#references)
* [Open source projects](#open-source-projects)
* [Open source libraries](#open-source-libraries)
* [Websites/Tutorials](#websites-tutorials)


## Introduction
This project is about a car that is controlled via ps4 controller or by our Android app to navigate the road during driving process. The main feature of this car is a platooning system in which the car connects to other cars using the V2V-protocol and safely follow or lead the others, by sending/receiving the commands.

## License
The project is licenced under **GNU Lesser General Public License v3.0**, gives a total free permission to use, copy, and distribute the copies, while considering any changes are completely not allowed. For more detailed information, check the [LICENSE file](https://github.com/LaizFigueroa/DIT168/blob/master/LICENSE) provided in the source directory.

## Organization
This repository is divided into three main folders:

**1. Joystick:** Where the code for the Android app is stored. 

**2. scripts:** On this folder all the scripts used by travis to push the docker images can be found.

**3. src:** Where all the source code is available, including links to other repositories forked and the docker-compose file used to run the microservices.
   - **3.1. Ancient:** Code that was used in the development phases and is not required anymore.   
   - **3.2. imu-microservice:** On this folder the code for running the imu microservice can be found.
   - **3.3. imu-receiver-microservice:** The microservice code to receive imu data from the car and to send it to v2v can be found here.
   - **3.4. Interceptor:** This folder contains the interceptor microservice, which is responsible to handle sensors and internal communications. It is possible to build a docker image directly on this folder to run the related microservice individually.
   - **3.5. app-server:** On this folder the server microservice to run on the car for the android application can be found.
   - **3.6. opendlv-signal-viewer:** On this submodule, you are going to be redirected to a new repository. This code is used to visualize the data exchanged during the communication.
   - **3.7. opendlv.miniature:** On this submodule, you can find the ps4 microservice. By clicking on that you will be redirected to a new repository. There you should select the `dit168` branch, go under `usecases/latest/test.ps4controller` and run docker-compose up.
   - **3.8. v2v-microservice:** On this folder you can find the microservice for communication across vehicles.
   - **3.9. docker-compose.yml & configuration:** Files to run all the microservices on the car at the same time.

**4. test:** This folder contains the TDD tests designed at the beginning of the project, but not used along the development phases and the dockerfile to build the test environment.

On the root directory, there are documents that are important for the project's organization, existence, and maintenance, such as the code conventions used to build the project, the license, the contributing, the code of conduct, Travis, git modules list.

## Getting Started
These instructions will get you a copy of the project up and run on your local machine for development and testing purposes.

### Cloning
The project can be cloned using the URL provided in the GitHub webpage of the project or you can clone the project by adding the following command on your terminal/bash:
```
git clone --recurse-submodules https://github.com/LaizFigueroa/DIT168.git
```
### Building
The Docker builds the project following the instructions in the dockerfile. A docker container is launched by running a docker image that will be loaded to the miniature car. The docker image loaded is an executable package to run an applicationâ€“the code, a runtime, libraries, environment variables, and configuration files. To be able to build each microservice independently you should access `src/<microservice>` and then:

- To build and send to the car using a .tar file
```
docker build -t dockerimg -f Dockerfile.manual.

docker save dockerimg > dit168.tar

cat dit168.tar | docker load
```

- To build and send to docker hub repository
```
docker build -t dockerimg -f Dockerfile.manual.

docker tag dockerimg DOCKER_HUB_REPOSITORY/dockerimg

docker push DOCKER_HUB_REPOSITORY/dockerimg
```

### Running Tests
Automated tests: There will be automated tests for the `master` generated by Travis working hand-in-hand with the production code, available on: [![Build Status](https://travis-ci.org/LaizFigueroa/DIT168.svg?branch=master)](https://travis-ci.org/LaizFigueroa/DIT168).

Manual Tests: Upon pull request and integration testing, the features implemented will be tested in the simulation environment first, this is done using the docker image created using the `test/Dockerfile` and running manually the specific tool needed. You can use it by running the following command:
```
docker build -t test .
docker run test
```
### Docker Images
All docker images for the car are available on the following repositories [V2V Docker hub repository](https://hub.docker.com/r/laiz/v2v/), [App-Server Docker hub repository](https://hub.docker.com/r/laiz/app/), [Interceptor Docker hub repository](https://hub.docker.com/r/laiz/interceptor/),  [Webview Docker hub repository](https://hub.docker.com/r/laiz/webview/), and [Imu Docker hub repository](https://hub.docker.com/r/laiz/imu_receiver/) or you can add the following command to your terminal:
```
docker pull laiz/v2v
docker pull laiz/interceptor
docker pull laiz/app
docker pull laiz/webview
docker pull laiz/imu_receiver
```
Two docker images are built for the Ubuntu, in case of need or for testing purposes. They can be found on our [Webview_Ubuntu Docker hub repository](https://hub.docker.com/r/laiz/webview_ubuntu/), and [V2V_Ubuntu Docker hub repository](https://hub.docker.com/r/laiz/v2v_ubuntu/) or you can add the following command to your terminal:

```
docker pull laiz/webview_ubuntu
docker pull laiz/v2v_ubuntu
```

### Docker Compose
There are different docker-compose.yml files, under the `src` directory, where each link the project's microservices for executing a particular functionality, except for imu-microservice and V2V. Regarding these two microservices, please follow their Readme files.

The following list represents the different docker-compose.yml files :
- **docker-compose-app.yml :**  contains the project's microservices, for running and remoting the car by the Android application.
- **docker-compose-leader.yml :** contains most of the project's microservices, for executing the car's functionality as a leader car.
- **docker-compose-follower.yml :** contains most of the project's microservices, for running the car's functionality as a follower car.

For running a desired `docker-compose.yml` file, you need to add the following command on the bash command line, on the respective folder `src` :
```
docker-compose -f [docker-compose file] up
```
For stopping the `docker-compose.yml` file:
```
docker-compose -f [docker-compose file] stop
```
For removing the created containers by the executed `docker-compose.yml` file.Hence, for conforming the deletion request choose the option **yes**:
```
docker-compose -f [docker-compose file] rm
```
## References
### Open source projects:
Some open source projects developed by **[Chalmers Revere](https://github.com/chalmers-revere)** are used mainly as sub-modules parts in this project, the repositories as following:
- **1. [opendlv.miniature](https://github.com/chalmers-revere/opendlv.miniature/tree/dit168):** under `usecases/latest/test.ps4controller` used as PS4 controller microservice. Furthermore, for running both `pwm-motor` and `odsupercomponent`.
- **2. [opendlv-device-ultrasonic-srf08](https://github.com/chalmers-revere/opendlv-device-ultrasonic-srf08):** used for collecting data from the ultrasonic sensors, incorporated in interceptor microservice.
- **3.[opendlv-signal-viewer](https://github.com/chalmers-revere/opendlv-signal-viewer):** used as the web-visualisation microservice.
### Open source libraries:
The library [libcluon](https://chrberger.github.io/libcluon/index.html) was used for establishing the network communications between:
- **1. The project's different microservices:** `internal communication` between the microservices.
- **2. The [V2V-protocol](https://github.com/DIT168-V2V-responsibles/v2v-protocol) microservice:** adjusted and used by the course's different groups, which is established for the `external communication` between the vehicles.
### Websites/Tutorials:
Code sources' references can be found individually under the `header` of each source code file in the `src`.
